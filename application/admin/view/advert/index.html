<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>

<![endif]-->
<link rel="stylesheet" type="text/css" href="__STATIC__/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="__STATIC__/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="__STATIC__/lib/Hui-iconfont/1.0.8/iconfont.css" />

<link rel="stylesheet" type="text/css" href="__STATIC__/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="__STATIC__/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->
</head>
<body>
<div class="page-container" style="padding:15px;">
    <div style="overflow:hidden">
        
        <a style="float:left;margin-left:10px" onclick="$('#uploadmodel').show()" class="btn btn-primary radius">添加广告图</a>
    </div>
    <div style="margin-top:15px" >
        <table class="table table-border table-bordered table-bg" >
            <tr>
                <th style="text-align:center;">图片</th>
                <th style="text-align:center;">跳转链接</th>
                <th style="text-align:center;">上传时间</th>
                <th style="text-align:center;">操作</th>
            </tr>
            
            <tr class="tr">
                <td style="text-align:center;" >
                    <img style="width:100px;height:50px;" src="" class="img"/>
                </td>
                <td style="text-align:center;" class="link"></td>
                <td style="text-align:center;"></td>
                <td style="text-align:center;">
                    <a href="javascript:;"  title="编辑" edit_id="" onclick="edit(this)"><i class="Hui-iconfont">&#xe6df;</i></a>
                    <a href="javascript:;"  onclick="del()" title="删除"><i class="Hui-iconfont">&#xe6e2;</i></a>
                </td>
            </tr>
            
        </table>
    </div>
    <!-- 添加模态框开始 -->
    <div id="uploadmodel" style="position:fixed;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:10;left:0;top:0;display:none">
        <div style="position:absolute;width:550px;left:50%;top:50%;transform:translate(-50%,-50%);background:white;padding:15px 0">
                <form id="uploadform" action="" method="post" class="form form-horizontal" id="form-article-add" enctype="multipart/form-data">     
                <div class="row cl f1">
                    <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>图片上传：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                    <span style="display: inline-block;vertical-align: middle; position:relative;">
                    <input type="text" readonly nullmsg="请添加附件" style="position: relative;vertical-align: top;line-height:30px;cursor:pointer;border: solid 1px #ddd;width:200px;" name="image">
                    <a href="javascript:void();" style="text-decoration:none;border-radius: 4px;border: solid 1px #ddd;position: relative;background-color: #5a98de;color: #fff;border-color: #5a98de;line-height:30px;padding: 6px;"><i class="Hui-iconfont">&#xe642;&nbsp;</i>浏览文件</a>
                    <input type="file" multiple name="img" style="width:300px;margin-left: -295px;line-height:30px;position: sticky;opacity: 0;cursor:pointer;font-size: 16px;" onchange="file(this)" class="files">
                    </span>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>跳转链接：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" name="link" id="" placeholder="" value="" class="input-text" style="width:90%">
                        </div>
                </div>
                <div class="row cl">
                    <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                        <button onclick="dosubmit()" class="btn btn-primary radius" type="button" ><i class="Hui-iconfont">&#xe632;</i> 提交</button>
                        
                        <button onclick="$('#uploadmodel').hide()" class="btn btn-danger radius" type="button" ><i class="Hui-iconfont">&#xe632;</i> 关闭</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- 添加模态框结束 -->
    <!-- 修改模态框开始 -->
    <div id="updatemodel" style="position:fixed;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:10;left:0;top:0;display:none">
        <div style="position:absolute;width:550px;left:50%;top:50%;transform:translate(-50%,-50%);background:white;padding:15px 0">
                <form id="updateform" action="" method="post" class="form form-horizontal" id="form-article-add" enctype="multipart/form-data">
                <input type="hidden" name="id" value="">
                <div class="row cl f1">
                    <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>图片上传：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                    <span style="display: inline-block;vertical-align: middle; position:relative;">
                    <input type="text" readonly nullmsg="请添加附件" style="position: relative;vertical-align: top;line-height:30px;cursor:pointer;border: solid 1px #ddd;width:200px;" name="demo">
                    <a href="javascript:void();" style="text-decoration:none;border-radius: 4px;border: solid 1px #ddd;position: relative;background-color: #5a98de;color: #fff;border-color: #5a98de;line-height:30px;padding: 6px;"><i class="Hui-iconfont">&#xe642;&nbsp;</i>浏览文件</a>
                    <input type="file" multiple name="img" style="width:300px;margin-left: -295px;line-height:30px;position: sticky;opacity: 0;cursor:pointer;font-size: 16px;" onchange="update(this)" class="files">
                    </span>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>跳转链接：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" name="link" id="" placeholder="" value="" class="input-text" style="width:90%">
                        </div>
                </div>
                <div class="row cl">
                    <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                        <button onclick="donesubmit()" class="btn btn-primary radius" type="button" ><i class="Hui-iconfont">&#xe632;</i> 提交</button>
                        
                        <button onclick="$('#updatemodel').hide()" class="btn btn-danger radius" type="button" ><i class="Hui-iconfont">&#xe632;</i> 关闭</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- 修改模态框结束 -->
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__STATIC__/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="__STATIC__/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__STATIC__/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="__STATIC__/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
<!-- 添加请求 -->
<script>
    var currentType = <?php echo $type;?>;
    $("#currentTypeSelect").val(currentType);
    var uploadurl = "{:url('advert/save')}";
    function dosubmit(){
        var form = document.getElementById("uploadform")
        if(form.img.value == ""){
            layer.alert("请选择图片")
            return
        }
       var formData = new FormData(form)
        $.ajax({
            url: uploadurl,
            type: "post",
            dataType : "json",
            data: formData,
            contentType: false,
            processData: false,
            success: function (res) {
                if(typeof res === "string"){
                    res = JSON.parse(res)
                }
                layer.alert(res.msg)
                if(res.code == 200){
                    $('#uploadmodel').hide()
                    if(currentType == type){
                        location.reload()
                    }
                }else{

                }
            }
        });
    }

    function gotypeselect(e){
        location.href = "{:url('advert/index')}?type=" + e.value
    }


    function edit(a){
            $('#updatemodel').show();
            var id = $(a).attr('edit_id');
            var tab = $(a).parents('.tr');
            // console.log( tab );
            var link = tab.find('.link').html();
            $('input[name=id]').val(id);
            $('input[name=link]').val(link);
   
    }

    function del(id){
        if(!confirm("确定删除吗")) return
        $.ajax({
            url : "{:url('advert/del')}",
            dataType : "json",
            data : {id:id},
            type : "get",
            success : function(res){
                layer.alert(res.msg)
                if(res.code == 200){
                    location.reload()
                }
            }
        })
    }

    // 修改操作
    function donesubmit(){
         var uploadurl = "{:url('advert/update')}";
        var form = document.getElementById("updateform")
        if(form.img.value == ""){
            layer.alert("请选择图片")
            return
        }
        var formData = new FormData(form)
        $.ajax({
            url: uploadurl,
            type: "post",
            dataType : "json",
            data: formData,
            contentType: false,
            processData: false,
            success: function (res) {
                    if(typeof res === "string"){
                        res = JSON.parse(res)
                    }
                    layer.alert(res.msg)
                    if(res.code == 200){
                        $('#updatemodel').hide()
                        
                    }else{

                    }
                }
            });
        }

    function file(e){
        var tab = $(e).val();
        $('input[name=image]').val(tab);
    }

    function update(c){
        var bba = $(c).val();
        $('input[name=demo]').val(bba);
    }
</script>
</body>
</html>